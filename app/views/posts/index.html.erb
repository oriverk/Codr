  <div class="posting-container">
    
    <% if user_signed_in? %>
    <%=link_to 'New Post', new_post_path(user_id: current_user.id) , type:"button", class:"btn btn-outline-dark btn-block"%>
    <% else %>
    <%=link_to 'New Post', 'login' , type:"button", class:"btn btn-outline-dark btn-block"%>
    <% end %>
  </div>

  <div class="posts-container">
    <% @posts.each do |post| %>
      <div class="post-container">
        <div class="user-info">
          <div class="user-name"><%= post.user_id %></div>
        </div>
        <div class="post-info">
          <p class="date"><%= post.date %></p>
        </div>
        <div id="capture" class="content">
          <div><%= Redcarpet::Markdown.new(Redcarpet::Render::HTML, fenced_code_blocks: true).render(post.content).html_safe %></div>
        </div>
        <div class="post-action">
          <% if user_signed_in? %>
            <% unless post.prtsc.attached? %>
              <%= form_with(model: post, local: true) do |form| %>
                <%= form.hidden_field :id, value: post.id %>
                <%= form.hidden_field :prtsc, value: "" %>
                <%= form.submit "Post", class:"btn btn-outline-dark", id:"tweet", value:"tweet" %>
              <% end %>
            <% else %>
              <%= link_to 'tweet', "https://twitter.com/intent/tweet?url=https://codr0.herokuapp.com/posts/#{post.id}&button_hashtag=Codr0&ref_src=twsrc%5Etfw", type:"button", class:"btn btn-outline-dark", target:"_blank" %>
            <% end %>
            <%= link_to 'Show', post, type:"button", class:"btn btn-outline-dark" %>
            <%= link_to 'Edit', edit_post_path(post) , type:"button", class:"btn btn-outline-dark"%>
            <%= link_to 'Destroy', post, method: :delete, data: { confirm: 'Are you sure?' } , type:"button", class:"btn btn-outline-dark"%>
          <% end %> 
        </div>
      </div>
    <% end%>
   </div>

   <script type="text/javascript">
      html2canvas(document.querySelector("#capture"),{scale:1, width:600}).then(canvas => {
        var base64 = canvas.toDataURL('image/jpeg', 1.0);
        document.getElementById('post_prtsc').setAttribute('value', base64);
        });
      </script>

    <script>
      var base = 'https://twitter.com/intent/tweet?url=';
      var pageUrl = 'https://codr0.herokuapp.com/posts/' + document.getElementById('post_id').value;
      var option = '&button_hashtag=Codr0&ref_src=twsrc%5Etfw';
      var href = base + pageUrl + option;
      var twit = document.getElementById('tweet');
      twit.addEventListener('click', function() {
        window.open( href );
      });
    </script>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
 

